<!DOCTYPE html>
<html>

<head>
    <title>Firebase Token Tester</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        #tokenArea {
            width: 100%;
            height: 150px;
            margin-top: 10px;
        }

        button {
            font-size: 16px;
            padding: 10px;
        }
    </style>
</head>

<body>
    <h2>Lấy ID Token của Firebase để Test</h2>
    <p>Nhấn nút bên dưới để đăng nhập bằng Google. ID Token sẽ xuất hiện trong ô văn bản.</p>

    <button id="loginBtn">1. Đăng nhập bằng Google</button>

    <h4>2. Sao chép Token này và dán vào Postman:</h4>
    <textarea id="tokenArea" placeholder="Token sẽ xuất hiện ở đây..."></textarea>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

    <script>
        // ==============================================================
        // BƯỚC 1: DÁN FIREBASE CONFIG CỦA BẠN VÀO ĐÂY
        // ==============================================================
        const firebaseConfig = {
            apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
            authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
            databaseURL: import.meta.env.VITE_FIREBASE_DATABASE_URL,
            projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
            storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
            messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
            appId: import.meta.env.VITE_FIREBASE_APP_ID,
        };
        // ==============================================================

        // Khởi tạo Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const provider = new firebase.auth.GoogleAuthProvider();

        const loginBtn = document.getElementById('loginBtn');
        const tokenArea = document.getElementById('tokenArea');

        loginBtn.onclick = async () => {
            try {
                // 1. Mở cửa sổ Pop-up để đăng nhập
                const result = await auth.signInWithPopup(provider);
                const user = result.user;

                tokenArea.value = "Đang lấy token...";

                // 2. Lấy ID Token từ user
                const idToken = await user.getIdToken(true); // true = force refresh

                // 3. Hiển thị token
                tokenArea.value = idToken;
                console.log("ID Token:", idToken);
                alert("Lấy Token thành công! Hãy sao chép token từ ô văn bản.");

            } catch (error) {
                console.error("Lỗi đăng nhập:", error);
                tokenArea.value = `Lỗi: ${error.message}`;
            }
        };
    </script>
</body>

</html>